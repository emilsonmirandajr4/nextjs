{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jr/Desktop/nextjs/app/api/twitter/trends/route.ts"],"sourcesContent":["type ApiTrendingTopic = {\r\n  tag: string;\r\n  tweets: string;\r\n  url: string;\r\n};\r\n\r\nconst BRAZIL_WOEID = 23424768;\r\n\r\nfunction formatTweetCount(count: number | null): string {\r\n  if (!count || count <= 0) return 'N/A';\r\n  if (count >= 1_000_000) return `${(count / 1_000_000).toFixed(1)}M`;\r\n  if (count >= 1_000) return `${(count / 1_000).toFixed(1)}K`;\r\n  return count.toString();\r\n}\r\n\r\nasync function fetchFromTwitterApi(): Promise<ApiTrendingTopic[] | null> {\r\n  const bearer = process.env.TWITTER_BEARER_TOKEN;\r\n\r\n  if (!bearer) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(\r\n      `https://api.twitter.com/1.1/trends/place.json?id=${BRAZIL_WOEID}`,\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${bearer}`,\r\n        },\r\n      },\r\n    );\r\n\r\n    if (!response.ok) {\r\n      return null;\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    if (!Array.isArray(data) || !data[0] || !Array.isArray(data[0].trends)) {\r\n      return null;\r\n    }\r\n\r\n    const trends = data[0].trends.slice(0, 7).map((trend: any) => ({\r\n      tag: trend.name as string,\r\n      tweets: formatTweetCount(trend.tweet_volume ?? null),\r\n      url: `https://twitter.com/search?q=${encodeURIComponent(trend.name as string)}`,\r\n    }));\r\n\r\n    return trends;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function fetchFromGetDayTrends(): Promise<ApiTrendingTopic[] | null> {\r\n  try {\r\n    const response = await fetch('https://getdaytrends.com/brazil/', {\r\n      headers: {\r\n        'User-Agent':\r\n          'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0 Safari/537.36',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      return null;\r\n    }\r\n\r\n    const html = await response.text();\r\n\r\n    const regex = /<td class=\"main\"><a[^>]*>([^<]+)<\\/a>/g;\r\n    const names: string[] = [];\r\n    let match: RegExpExecArray | null;\r\n\r\n    while ((match = regex.exec(html)) !== null) {\r\n      names.push(match[1].trim());\r\n      if (names.length >= 10) break;\r\n    }\r\n\r\n    if (names.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const trends: ApiTrendingTopic[] = names.map((name) => ({\r\n      tag: name,\r\n      tweets: 'N/A',\r\n      url: `https://twitter.com/search?q=${encodeURIComponent(name)}`,\r\n    }));\r\n\r\n    return trends;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction getFallbackTrends(): ApiTrendingTopic[] {\r\n  return [\r\n    { tag: '#Brasil', tweets: '127K', url: 'https://twitter.com/search?q=%23Brasil' },\r\n    { tag: '#Pol√≠tica', tweets: '89K', url: 'https://twitter.com/search?q=%23Pol%C3%ADtica' },\r\n    { tag: '#Economia', tweets: '56K', url: 'https://twitter.com/search?q=%23Economia' },\r\n    { tag: '#Esportes', tweets: '142K', url: 'https://twitter.com/search?q=%23Esportes' },\r\n    { tag: '#Tecnologia', tweets: '34K', url: 'https://twitter.com/search?q=%23Tecnologia' },\r\n  ];\r\n}\r\n\r\nexport async function GET(): Promise<Response> {\r\n  try {\r\n    let trends = await fetchFromTwitterApi();\r\n\r\n    if (!trends) {\r\n      trends = await fetchFromGetDayTrends();\r\n    }\r\n\r\n    if (!trends) {\r\n      trends = getFallbackTrends();\r\n    }\r\n\r\n    return new Response(JSON.stringify(trends), {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Cache-Control': 'public, s-maxage=300, stale-while-revalidate=600',\r\n      },\r\n    });\r\n  } catch {\r\n    const trends = getFallbackTrends();\r\n    return new Response(JSON.stringify(trends), {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Cache-Control': 'public, s-maxage=300, stale-while-revalidate=600',\r\n      },\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}