{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jr/Desktop/nextjs/src/config/wordpress.ts"],"sourcesContent":["export const WORDPRESS_CONFIG = {\r\n  API_BASE: 'https://primeiranews.com.br/wp-json/wp/v2',\r\n  SITE_URL: 'https://primeiranews.com.br',\r\n\r\n  CACHE_TTL: {\r\n    POSTS_LIST: 60 * 60 * 1000, // 1 hora\r\n    POST_SINGLE: 24 * 60 * 60 * 1000, // 24 horas\r\n    CATEGORIES: 7 * 24 * 60 * 60 * 1000, // 7 dias\r\n    TAGS: 7 * 24 * 60 * 60 * 1000, // 7 dias\r\n    MEDIA: 7 * 24 * 60 * 60 * 1000, // 7 dias\r\n  },\r\n\r\n  PAGINATION: {\r\n    PER_PAGE: 10,\r\n    MAX_PAGES: 100,\r\n  },\r\n\r\n  FIELDS: {\r\n    POSTS: 'id,title,excerpt,content,date,link,categories,featured_media,author',\r\n    CATEGORIES: 'id,name,slug,count,description',\r\n    TAGS: 'id,name,slug,count',\r\n    MEDIA: 'id,title,media_details,source_url',\r\n  },\r\n};\r\n\r\nexport default WORDPRESS_CONFIG;\r\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,mBAAmB;IAC9B,UAAU;IACV,UAAU;IAEV,WAAW;QACT,YAAY,KAAK,KAAK;QACtB,aAAa,KAAK,KAAK,KAAK;QAC5B,YAAY,IAAI,KAAK,KAAK,KAAK;QAC/B,MAAM,IAAI,KAAK,KAAK,KAAK;QACzB,OAAO,IAAI,KAAK,KAAK,KAAK;IAC5B;IAEA,YAAY;QACV,UAAU;QACV,WAAW;IACb;IAEA,QAAQ;QACN,OAAO;QACP,YAAY;QACZ,MAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jr/Desktop/nextjs/src/server/wordpress.ts"],"sourcesContent":["import 'server-only';\r\n\r\nimport { WORDPRESS_CONFIG } from '../config/wordpress';\r\nimport { WordPressPost } from '../types/wordpress';\r\n\r\nconst WP_API_URL = WORDPRESS_CONFIG.API_BASE;\r\n\r\nconst msToSeconds = (ms: number): number => {\r\n  return Math.max(1, Math.floor(ms / 1000));\r\n};\r\n\r\nconst createCacheControlHeader = (ttlMs: number): string => {\r\n  const seconds = msToSeconds(ttlMs);\r\n  return `public, s-maxage=${seconds}, stale-while-revalidate=${seconds}`;\r\n};\r\n\r\nasync function wpFetchJson<T>(url: string, ttlMs: number): Promise<T> {\r\n  const seconds = msToSeconds(ttlMs);\r\n\r\n  const init: RequestInit & { next?: { revalidate?: number } } = {\r\n    headers: {\r\n      Accept: 'application/json',\r\n    },\r\n    next: {\r\n      revalidate: seconds,\r\n    },\r\n  };\r\n\r\n  const response = await fetch(url, init);\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`WordPress HTTP ${response.status}: ${response.statusText}`);\r\n  }\r\n\r\n  const text = await response.text();\r\n  if (!text) {\r\n    throw new Error('Empty response from WordPress');\r\n  }\r\n\r\n  return JSON.parse(text) as T;\r\n}\r\n\r\nfunction withCategoryNames(posts: WordPressPost[]): WordPressPost[] {\r\n  return posts.map((post) => {\r\n    const categories_names =\r\n      post._embedded?.['wp:term']?.[0]?.map((cat: any) => cat.name) || [];\r\n    return {\r\n      ...post,\r\n      categories_names,\r\n    };\r\n  });\r\n}\r\n\r\nexport async function getPosts(\r\n  perPage: number,\r\n  page: number,\r\n): Promise<WordPressPost[]> {\r\n  const url = `${WP_API_URL}/posts?_embed&per_page=${perPage}&page=${page}&orderby=date&order=desc`;\r\n  const data = await wpFetchJson<WordPressPost[]>(\r\n    url,\r\n    WORDPRESS_CONFIG.CACHE_TTL.POSTS_LIST,\r\n  );\r\n  return withCategoryNames(data);\r\n}\r\n\r\nconst normalizeText = (value: string): string => {\r\n  return value.normalize('NFD').replace(/\\p{Diacritic}/gu, '').toLowerCase();\r\n};\r\n\r\nexport async function getCategoryIdBySlug(\r\n  slug: string,\r\n): Promise<number | null> {\r\n  const exactUrl = `${WP_API_URL}/categories?slug=${encodeURIComponent(slug)}`;\r\n  const exact = await wpFetchJson<any[]>(\r\n    exactUrl,\r\n    WORDPRESS_CONFIG.CACHE_TTL.CATEGORIES,\r\n  );\r\n  if (Array.isArray(exact) && exact.length > 0) {\r\n    return exact[0].id ?? null;\r\n  }\r\n\r\n  const searchUrl = `${WP_API_URL}/categories?search=${encodeURIComponent(\r\n    slug,\r\n  )}`;\r\n  const cats = await wpFetchJson<any[]>(\r\n    searchUrl,\r\n    WORDPRESS_CONFIG.CACHE_TTL.CATEGORIES,\r\n  );\r\n\r\n  if (!Array.isArray(cats) || cats.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const norm = normalizeText(slug);\r\n  const best =\r\n    cats.find((c: any) => normalizeText(c.slug) === norm) ??\r\n    cats.find((c: any) => normalizeText(c.name).includes(norm));\r\n\r\n  return best ? best.id : cats[0].id ?? null;\r\n}\r\n\r\nexport async function getPostsByCategoryId(\r\n  categoryId: number,\r\n  perPage: number,\r\n  page: number,\r\n): Promise<WordPressPost[]> {\r\n  const url = `${WP_API_URL}/posts?_embed&categories=${categoryId}&per_page=${perPage}&page=${page}&orderby=date&order=desc`;\r\n\r\n  const data = await wpFetchJson<WordPressPost[]>(\r\n    url,\r\n    WORDPRESS_CONFIG.CACHE_TTL.POSTS_LIST,\r\n  );\r\n\r\n  return withCategoryNames(data);\r\n}\r\n\r\nexport async function getPostsByCategorySlug(\r\n  slug: string,\r\n  perPage: number,\r\n  page: number,\r\n): Promise<WordPressPost[]> {\r\n  const categoryId = await getCategoryIdBySlug(slug);\r\n  if (!categoryId) {\r\n    return [];\r\n  }\r\n  return getPostsByCategoryId(categoryId, perPage, page);\r\n}\r\n\r\nexport async function getPostBySlug(\r\n  slug: string,\r\n): Promise<WordPressPost | null> {\r\n  const url = `${WP_API_URL}/posts?_embed&slug=${encodeURIComponent(slug)}`;\r\n  const data = await wpFetchJson<WordPressPost[]>(\r\n    url,\r\n    WORDPRESS_CONFIG.CACHE_TTL.POST_SINGLE,\r\n  );\r\n\r\n  if (!Array.isArray(data) || data.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const [post] = data;\r\n  const [postWithCategories] = withCategoryNames([post]);\r\n\r\n  return postWithCategories;\r\n}\r\n\r\nexport const getPostsListCacheControl = (): string =>\r\n  createCacheControlHeader(WORDPRESS_CONFIG.CACHE_TTL.POSTS_LIST);\r\n\r\nexport const getPostSingleCacheControl = (): string =>\r\n  createCacheControlHeader(WORDPRESS_CONFIG.CACHE_TTL.POST_SINGLE);\r\n\r\nexport const getCategoryPostsCacheControl = (): string =>\r\n  createCacheControlHeader(WORDPRESS_CONFIG.CACHE_TTL.POSTS_LIST);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jr/Desktop/nextjs/app/api/posts/%5Bslug%5D/route.ts"],"sourcesContent":["import { WORDPRESS_CONFIG } from '../../../../src/config/wordpress';\r\nimport {\r\n  getPostBySlug,\r\n  getPostSingleCacheControl,\r\n} from '../../../../src/server/wordpress';\r\n\r\nexport async function GET(\r\n  _request: any,\r\n  { params }: { params: Promise<{ slug: string }> },\r\n) {\r\n  const { slug } = await params;\r\n\r\n  if (!slug) {\r\n    return new Response(JSON.stringify({ error: 'Slug é obrigatório' }), {\r\n      status: 400,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Cache-Control': 'private, no-store',\r\n      },\r\n    });\r\n  }\r\n\r\n  try {\r\n    const post = await getPostBySlug(slug);\r\n\r\n    if (!post) {\r\n      return new Response(\r\n        JSON.stringify({ error: 'Notícia não encontrada' }),\r\n        {\r\n          status: 404,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Cache-Control': 'public, max-age=60',\r\n          },\r\n        },\r\n      );\r\n    }\r\n\r\n    return new Response(JSON.stringify(post), {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Cache-Control': getPostSingleCacheControl(),\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error('Error in /api/posts/[slug]', error);\r\n    return new Response(\r\n      JSON.stringify({ error: 'Falha ao carregar notícia.' }),\r\n      {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Cache-Control': 'private, no-store',\r\n        },\r\n      },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAKO,eAAe,IACpB,QAAa,EACb,EAAE,MAAM,EAAyC;IAEjD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;IAEvB,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAqB,IAAI;YACnE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;YACnB;QACF;IACF;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,6IAAa,EAAC;QAEjC,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAyB,IACjD;gBACE,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB;gBACnB;YACF;QAEJ;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,OAAO;YACxC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,IAAA,yJAAyB;YAC5C;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YAAE,OAAO;QAA6B,IACrD;YACE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;YACnB;QACF;IAEJ;AACF"}}]
}